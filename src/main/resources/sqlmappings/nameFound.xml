<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright 2011 Global Biodiversity Information Facility (GBIF)
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<!DOCTYPE mapper
    PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
    "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="org.gbif.pubindex.model.NameFound">

  <resultMap type="NameFound" id="nameFoundRecordResult">
    <id property="id" column="id"/>
    <result column="article_fk" property="articleId"/>
    <result column="nub_id" property="nubId"/>
    <result column="source" property="sourceAsInt"/>
    <result column="name" property="name"/>
    <result column="name_verbatim" property="nameVerbatim"/>
    <result column="novum" property="novum"/>
    <result column="offset_start" property="offsetStart"/>
    <result column="offset_end" property="offsetEnd"/>
    <result column="confidence" property="confidence"/>
    <result column="ubio" property="ubio"/>

  </resultMap>

  <sql id="nameFoundBasic">select n.* from name_found n </sql>

  <select id="getNameFound" parameterType="int" resultMap="nameFoundRecordResult">
    <include refid="nameFoundBasic"/>where n.id = #{id}
  </select>

  <delete id="deleteNameFound" parameterType="int">
    delete from name_found where id = #{id}
  </delete>

  <insert id="insertNameFound" parameterType="NameFound" useGeneratedKeys="true" keyProperty="id">
    insert into name_found (article_fk, name,
      name_verbatim, novum,
      offset_start, offset_end, confidence, nub_id, source)
    values (#{articleId,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR},
      #{nameVerbatim,jdbcType=VARCHAR}, #{novum,jdbcType=BIT},
      #{offsetStart,jdbcType=INTEGER}, #{offsetEnd,jdbcType=INTEGER}, #{confidence,jdbcType=INTEGER},
      #{nubId,jdbcType=INTEGER}, #{sourceAsInt,jdbcType=SMALLINT})
  </insert>

  <update id="updateNameFound" parameterType="NameFound">
    update name_found
    set article_fk = #{articleId,jdbcType=INTEGER},
      name = #{name,jdbcType=VARCHAR},
      name_verbatim = #{nameVerbatim,jdbcType=VARCHAR},
      novum = #{novum,jdbcType=BIT},
      offset_start = #{offsetStart,jdbcType=INTEGER},
      offset_end = #{offsetEnd,jdbcType=INTEGER},
      confidence = #{confidence,jdbcType=INTEGER},
      nub_id = #{nubId,jdbcType=INTEGER},
      source = #{sourceAsInt,jdbcType=SMALLINT}
    where id = #{id,jdbcType=INTEGER}
  </update>



  <select id="list" resultMap="nameFoundRecordResult">
    <include refid="nameFoundBasic"/>
  </select>
  <select id="getByArticle" parameterType="int" resultMap="nameFoundRecordResult">
    <include refid="nameFoundBasic"/> where n.article_fk = #{id}
  </select>
  <select id="getByJournal" parameterType="int" resultMap="nameFoundRecordResult">
    <include refid="nameFoundBasic"/> join article a on n.article_fk=a.id where a.journal_fk = #{id}
  </select>

  <delete id="deleteByArticle" parameterType="int">
    delete from name_found
     where article_fk = #{id}
  </delete>

</mapper>
